build:
  gpu: true
  cuda: "12.4"
  system_packages:
    - "ffmpeg"
  python_version: "3.12"
  python_packages:
    - "torch"
    - "torchvision"
    - "deepspeed"
    - "toml"
    - "transformers"
    - "diffusers>=0.32.1"
    - "datasets"
    - "pillow"
    - "sentencepiece"
    - "protobuf"
    - "peft"
    - "tensorboard"
    - "tqdm"
    - "safetensors"
    - "bitsandbytes"
    - "imageio[ffmpeg]"
    - "av"
    - "einops"
    - "accelerate"
    - "loguru"
    - "omegaconf"
    - "iopath"
    - "termcolor"
    - "hydra-core"
    - "easydict"
    - "ftfy"
    - "imageio[pyav]"
    - "albumentations==1.4.3"
    - "hf-transfer"

    # for Qwen
    # - "torch==2.1.2"
    # - "transformers"
    # - "accelerate"
    - "numpy<2"
    - "qwen-vl-utils"
    - "av"
  run:
    - "FLASH_ATTENTION_SKIP_CUDA_BUILD=TRUE pip install flash-attn --no-build-isolation"
    - "curl -o /usr/local/bin/pget -L \"https://github.com/replicate/pget/releases/latest/download/pget_linux_x86_64\" && chmod +x /usr/local/bin/pget"
    # - "pip install onnxruntime-gpu --extra-index-url https://aiinfra.pkgs.visualstudio.com/PublicPackages/_packaging/onnxruntime-cuda-12/pypi/simple/"
    # - "pip install pydantic==2.10.6"
    # - "pip install imageio[ffmpeg] imageio[pyav]"
predict: "predict.py:Predictor"
train: "cog_train.py:train"